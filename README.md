# hall-opt

## Project Overview
This project uses the HallThruster.jl Julia package, integrated with Python through Juliacall, to simulate and optimize the behavior of a Hall Thruster.

# Key Features:
- MultiLogBohm Simulation: Simulates Hall Thruster behavior using the MultiLogBohm model.
- TwoZoneBohm Simulation: Uses MAP (Maximum A Posteriori) parameter optimization to simulate Hall Thruster behavior.
- MAP Estimation: Optimizes key model parameters using MAP.
- Result Comparison: Visualize and compare simulation results against observed data.

## Step 1: Install PDM
If PDM is not installed, install it via pip:
    #pip install pdm

## Step 2: Install Project Dependencies
Once PDM is installed, clone the repository and install the dependencies:

# Clone the repository
    git clone https://github.com/elsensoy/HallOpt.git
    cd hall-opt

# Install Python dependencies with PDM
    pdm install
PDM will create a virtual environment and install all necessary dependencies, including matplotlib, scipy, and juliacall.

    # Activate the PDM virtual environment:
    pdm venv activate

<!-- Julia Installation -->
Ensure Julia is installed. Also the following Julia packages:
    import Pkg
    Pkg.add("HallThruster")
    Pkg.add("JSON3")

    #Install HallThrusterPEM manually if needed
     git clone https://github.com/JANUS-Institute/HallThrusterPEM.git
     cd HallThrusterPEM
     pdm install


## Step 3: Running the Project
Once the dependencies are installed, you can run the main simulation script.

    cd hall_opt
    pdm run python mcmc.py

# The script include the following tasks:
Simulates the Hall Thruster using MultiLogBohm.
Optimizes parameters using MAP for TwoZoneBohm.
Saves results for different ion velocity weights.

Ion velocity weight is set by default: 
    ion_velocity_weights = [2.0]

# Expected Outputs
Results are saved in results/mcmc-results/ directories in JSON format. Key outputs include:
Ground Truth Data: Results from the initial MultiLogBohm simulation.(mcmc_observed_data_map.json)
Optimized Parameters: Best-fit parameters from MAP estimation.
(mcmc_pre_mcmc_initial.json)
Performance Metrics: Metrics like thrust, ion velocity, and discharge current.
iteration_metrics/iteration_1_metrics.json, iteration_2_metrics.json...
Checkpoint file: Includes every 10th sample results. Generated for tracking the results and for resuming MCMC if needed. 
checkpoint_1.csv
Final results: Includes simulation parameter values (c1, c2) for the mcmc chain. final_samples_1.csv
Metadata: Post-processing information for each run: Optimized initial point(map results), timestamp, initial covariance scaling, number of iterations, final acceptance rate, results directories, and additional model configuration information.
## Step 4: Visualizing Results
To visualize the results, you can use the plotting scripts in mcmc-plot-files. For example, you can generate trace plots by running:
    pdm run python visualization.py
This script will generate autocorrelation, trace, posterior, and pair plots, comparing samples with observed and pre-mcmc(optimized initial guess), saving the plots in ../results/mcmc-results-{the respected results dir increment.}/plots.

# Dependencies
The Python dependencies are listed in the pyproject.toml. The main dependencies include:

    matplotlib
    juliacall
    scipy


# Project Structure

    model_error_uq_plasma/
    ├── .gitignore
    ├── .pdm-python
    ├── .venv/                  # Python virtual environment
    ├── HallThrusterPEM/        # Core module for Hall thruster modeling
    ├── Manifest.toml           # Dependency tracking for Julia packages
    ├── MCMCIterators/          # MCMC iterator implementations
    ├── Project.toml            # Julia project configuration
    ├── README.md               # Project overview
    ├── bfield_spt100.csv       # Magnetic field data for SPT-100 thruster
    ├── extract_metrics.jl      # Julia script for extracting key metrics
    ├── hall_opt/               # Optimization routines for thruster parameters
    │   ├── Manifest.toml            # Dependency tracking for Python or Julia packages
    │   ├── Project.toml             # Project configuration
    │   ├── README.md                # Subdirectory-specific overview
    │   ├── mcmc.log                 # Log file for MCMC runs
    │   ├── mcmc.py                  # Python script for MCMC methods
    │   ├── mcmc_utils.py            # Utility functions for MCMC processing
    │   ├── map_nelder_mead.py       # Nelder-Mead optimization script
    │   ├── resume_from_checkpoint.py # Resume MCMC runs from a saved state
    │   ├── mcmc-plot-files/         # Directory for plots generated by MCMC runs
    │   ├── results/                 # Directory for storing MCMC results
    │   └── __pycache__/             # Python cache directory
    ├── misc/                   # Miscellaneous utilities and files
    ├── pdm.lock                # Python dependency lock file
    ├── pyproject.toml          # Python project configuration
    ├── requirements.txt        # Python dependencies
    ├── results-Nelder-Mead/    # Results from Nelder-Mead optimization
    ├── setup.jl                # Julia setup script
    ├── tests/                  # Unit and integration tests
    └── venv/                   # Python virtual environment (duplicate of .venv)


Feel free to contact me at elsensoy@umich.edu!
